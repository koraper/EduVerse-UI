# EduVerse 기능 명세서 - Part 4: 관리자 기능

## 📋 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 기능 명세서 Part 4: 관리자 기능 |
| 버전 | 1.3 |
| 최종 수정일 | 2025-10-19 11:15 |
| 상태 | 개발 중 |
| 관련 문서 | PRD v2.8, 역할별 기능 리스트 v3.7, 시스템 아키텍처 v1.4 |

## 📝 변경 이력

| 버전 | 일자 및 시간 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.3 | 2025-10-19 11:15 | 정합성 개선: 관리 로그 기능 추가 (AD-LOG-01, AD-LOG-02), PRD v2.8, 역할별 기능 리스트 v3.7, 시스템 아키텍처 v1.4 반영 | Claude AI |
| 1.2 | 2025-10-19 10:30 | AD-USER-04(사용자 정보 수정), AD-USER-05(사용자 삭제) 추가 | Claude AI |
| 1.1 | 2025-10-17 14:00 | 문서 정보 한글화 | Claude AI |
| 1.0 | 2025-01-14 09:00 | 초기 버전 작성 | Claude AI |

---

## 📖 전체 문서 목차

**Part 1: 개요 및 인증** → [01-overview-and-auth.md](./01-overview-and-auth.md)
- 1. 개요
- 2. 명세서 작성 가이드
- 3. 랜딩페이지 기능
- 4. 인증 및 인가

**Part 2: 학생 기능** → [02-student-features.md](./02-student-features.md)
- 5. 학생 기능

**Part 3: 교수자 기능** → [03-professor-features.md](./03-professor-features.md)
- 6. 교수자 기능

**Part 4: 관리자 기능** (현재 문서)
- 7. [관리자 기능](#7-관리자-기능)

**Part 5: 공통 가이드** → [05-common-guidelines.md](./05-common-guidelines.md)
- 8. 공통 기능
- 9. UI/UX 공통 가이드
- 10. 기술 제약사항

---

## 관련 문서

- **[UI 와이어프레임](../04-design/wireframes/)** (상세 화면 설계)
  - [관리자 화면](../04-design/wireframes/05-admin-wireframes.md)
  - [공통화면 (인증)](../04-design/wireframes/02-common-wireframes.md)

> **💡 UI 요소 참고**: 이 문서의 UI 요소 섹션은 간단한 개요만 포함합니다. 상세한 와이어프레임과 컴포넌트 명세는 위의 와이어프레임 문서를 참조하세요.

---

## 7. 관리자 기능

### AD-USER-01 전체 사용자 조회

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 관리자가 모든 사용자(학생, 교수자) 목록을 조회합니다.
- 사용자 상태, 역할, 가입일 등을 확인할 수 있습니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 모든 사용자 목록을 확인하고
SO THAT 사용자 관리 및 모니터링을 수행할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| page | integer | ❌ | 페이지 번호 | 기본: 1 |
| limit | integer | ❌ | 페이지당 개수 | 기본: 10, 최대: 100 |
| role | enum | ❌ | 역할 필터 | all/student/professor |
| status | enum | ❌ | 상태 필터 | all/active/inactive/suspended |

#### 처리 로직
1. 관리자 대시보드 → "사용자 관리" 메뉴 클릭
2. `GET /api/admin/users` 호출
3. 서버에서 사용자 목록 조회:
   ```sql
   SELECT id, email, name, role, status, created_at, last_login
   FROM users
   WHERE
     (? = 'all' OR role = ?)
     AND (? = 'all' OR status = ?)
   ORDER BY created_at DESC
   LIMIT ? OFFSET ?
   ```
4. 사용자 목록 렌더링
5. 페이지네이션 표시

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| users | array | 사용자 배열 |
| users[].id | integer | 사용자 ID |
| users[].email | string | 이메일 |
| users[].name | string | 이름 |
| users[].role | enum | 역할 (student/professor/admin) |
| users[].status | enum | 상태 (active/inactive/suspended) |
| users[].created_at | timestamp | 가입일 |
| users[].last_login | timestamp | 마지막 로그인 |
| total | integer | 전체 사용자 수 |
| page | integer | 현재 페이지 |

#### UI 요소

**사용자 관리 페이지**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 사용자 관리                                                       │
│ [전체: 234명] [학생: 200명] [교수자: 34명]                       │
├──────────────────────────────────────────────────────────────────┤
│ 역할: [전체 ▼]  상태: [전체 ▼]  [검색: ___________] [🔍]       │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│ ID  │ 이메일              │ 이름   │ 역할  │ 상태  │ 가입일      │
│ ────┼────────────────────┼───────┼──────┼──────┼─────────── │
│ 234 │ student@edu.com    │ 김철수 │ 학생  │ 활성  │ 2025-10-15 │
│ 233 │ prof@edu.com       │ 이교수 │ 교수자│ 활성  │ 2025-10-14 │
│ 232 │ test@edu.com       │ 박학생 │ 학생  │ 정지  │ 2025-10-13 │
│ ... │                    │       │      │      │            │
│                                                                   │
│ [◀ 이전] 페이지 1/5 [다음 ▶]                                     │
└──────────────────────────────────────────────────────────────────┘
```

#### 제약사항

**기술적 제약**:
- 사용자 목록 조회 API 응답 시간: < 1초
- 페이지네이션: 기본 10개씩, 최대 100개씩

**보안 제약**:
- 관리자만 접근 가능
- 비밀번호는 조회 불가

#### 관련 기능/API
- `GET /api/admin/users`: 사용자 목록 조회
- AD-USER-02: 사용자 검색
- AD-USER-03: 사용자 상태 변경

---

### AD-USER-02 사용자 검색

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 이메일, 이름으로 특정 사용자를 검색합니다.

#### 처리 로직
1. 검색어 입력
2. `GET /api/admin/users/search?q={query}` 호출
3. 서버에서 검색:
   ```sql
   SELECT *
   FROM users
   WHERE email LIKE ? OR name LIKE ?
   LIMIT 10
   ```
4. 검색 결과 표시

#### 관련 기능/API
- `GET /api/admin/users/search`: 사용자 검색
- AD-USER-01: 전체 사용자 조회

---

### AD-USER-03 사용자 상태 변경

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 사용자 계정을 활성화/비활성화/정지 처리합니다.

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| user_id* | integer | ✅ | 사용자 ID | - |
| status* | enum | ✅ | 변경할 상태 | active/inactive/suspended |
| reason | string | ❌ | 변경 사유 | 정지 시 필수 |

#### 처리 로직
1. 사용자 목록에서 상태 변경 버튼 클릭
2. 확인 모달 표시
3. `PATCH /api/admin/users/{user_id}/status` 호출
4. 서버에서 상태 업데이트:
   ```sql
   UPDATE users
   SET status = ?, updated_at = NOW()
   WHERE id = ?
   ```
5. 로그 기록:
   ```sql
   INSERT INTO admin_logs (admin_id, action, target_user_id, reason, created_at)
   VALUES (?, 'change_user_status', ?, ?, NOW())
   ```

#### UI 요소

**상태 변경 확인 모달**:
```
┌────────────────────────────────────────────────────┐
│ 사용자 상태 변경                              [X]  │
├────────────────────────────────────────────────────┤
│                                                     │
│ 사용자: 김철수 (student@edu.com)                   │
│ 현재 상태: 활성                                     │
│                                                     │
│ 변경할 상태: [정지 ▼]                              │
│                                                     │
│ 사유 (필수):                                        │
│ [___________________________________________]       │
│                                                     │
│ ⚠️ 정지된 사용자는 로그인할 수 없습니다            │
│                                                     │
│               [취소]  [변경]                        │
└────────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자 본인은 자신의 상태를 변경할 수 없음
- 모든 상태 변경은 로그에 기록

#### 관련 기능/API
- `PATCH /api/admin/users/{user_id}/status`: 상태 변경
- AD-USER-01: 전체 사용자 조회

---

### PR-RPT-01 학습 분석 대시보드

**우선순위**: P0
**담당 역할**: Professor

#### 기능 개요
- 수업 종료 후 전체 학생의 학습 패턴, 어려워한 부분을 종합 분석합니다.
- 오프라인 수업의 효과성을 평가하고 개선점을 도출합니다.

#### 사용자 스토리
```
AS A 교수자
I WANT TO 수업이 끝난 후 학생들의 전체 학습 데이터를 분석하고
SO THAT 어떤 부분이 어려웠는지 파악하여 다음 수업을 개선할 수 있다
```

#### 전제조건
- 교수자로 로그인된 상태
- 수업 진행 중 또는 완료

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| class_id* | integer | ✅ | 수업 ID | - |

#### 처리 로직
1. 교수자 대시보드 → 수업 선택 → "📊 학습 분석" 탭 클릭
2. `GET /api/classes/{class_id}/analytics` 호출
3. 서버에서 분석 데이터 생성:
   - 전체 학생 평균 진도율
   - 주차별 완료율
   - 어려웠던 과제 Top 5 (테스트 실패율 기준)
   - 평균 학습 시간
   - 질문 빈도 분석
4. 데이터 시각화 렌더링

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| overall_completion | float | 전체 평균 진도율 (%) |
| total_students | integer | 총 학생 수 |
| average_time_spent | integer | 평균 학습 시간 (분) |
| week_completion_rates | array | 주차별 완료율 |
| difficult_tasks | array | 어려운 과제 Top 5 |
| question_stats | object | 질문 통계 |

#### UI 요소

**학습 분석 대시보드**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 자료구조 및 알고리즘 | 학습 분석 리포트                            │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│ 📊 전체 요약                                                      │
│ ┌─────────────┬─────────────┬─────────────┬─────────────┐       │
│ │ 평균 진도율 │ 완료 학생   │ 평균 시간   │ 질문 수     │       │
│ │    68%      │  15/23명   │  18시간     │   89개      │       │
│ └─────────────┴─────────────┴─────────────┴─────────────┘       │
│                                                                   │
│ 📈 주차별 완료율                                                  │
│ Week 1  ████████████████████ 95%                                 │
│ Week 2  ██████████████████░░ 87%                                 │
│ Week 3  ████████████░░░░░░░░ 62%  ⚠️ 낮음                        │
│ Week 4  ██████░░░░░░░░░░░░░░ 34%  ⚠️ 매우 낮음                   │
│ Week 5  ░░░░░░░░░░░░░░░░░░░░ 8%                                  │
│                                                                   │
│ ⚠️ 어려웠던 과제 Top 5                                            │
│ 1. Week 3 - 정렬 알고리즘 (테스트 실패율 68%)                    │
│    💡 추천: 예제 코드 추가, 시각화 자료 제공                      │
│ 2. Week 2 - 딕셔너리 활용 (실패율 45%)                           │
│ 3. Week 4 - 스택 구현 (실패율 42%)                               │
│ ...                                                               │
│                                                                   │
│ 💬 질문 분석                                                      │
│ - 총 질문: 89개 (평균 답변 시간: 12분)                           │
│ - 가장 많은 질문: "정렬 알고리즘" (17개)                          │
│ - 긴급 질문: 12개                                                 │
│                                                                   │
│ [상세 리포트 다운로드 (Excel)]                                    │
└──────────────────────────────────────────────────────────────────┘
```

#### 제약사항

**기술적 제약**:
- 분석 데이터 생성 시간: < 3초
- 실시간 데이터 반영 (학생 활동 시 즉시 업데이트)

**비즈니스 제약**:
- 학생 수 5명 미만 시 개인정보 보호를 위해 일부 통계 비공개

#### 관련 기능/API
- `GET /api/classes/{class_id}/analytics`: 학습 분석 데이터
- PR-MON-01: 실시간 대시보드
- PR-QNA-01: 질문 목록

---

### AD-USER-04 사용자 정보 수정

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 사용자의 기본 정보(이름, 이메일, 역할)를 수정합니다.
- 사용자 계정 정보를 관리자가 직접 변경할 수 있습니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 사용자의 기본 정보를 수정하고
SO THAT 잘못 등록된 정보나 변경된 정보를 시스템에 반영할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| user_id* | integer | ✅ | 사용자 ID | - |
| name | string | ❌ | 사용자 이름 | 2-50자, 한글/영문/공백만 허용 |
| email | string | ❌ | 이메일 | RFC 5322 표준, 중복 불가 |
| role | enum | ❌ | 역할 | student/professor/admin |

#### 처리 로직
1. 사용자 목록에서 수정 아이콘 클릭
2. 수정 모달 표시 (현재 정보 프리필)
3. `PATCH /api/admin/users/{user_id}` 호출
4. 서버에서 정보 업데이트:
   ```sql
   UPDATE users
   SET name = ?, email = ?, role = ?, updated_at = NOW()
   WHERE id = ?
   ```
5. 로그 기록:
   ```sql
   INSERT INTO admin_logs (admin_id, action, target_user_id, details, created_at)
   VALUES (?, 'change_user_status', ?, ?, NOW())
   ```

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| user | object | 수정된 사용자 정보 |
| logCreated | boolean | 로그 기록 여부 |

#### UI 요소

**사용자 정보 수정 모달**:
```
┌─────────────────────────────────────────────────┐
│ 사용자 정보 수정                            [X]  │
├─────────────────────────────────────────────────┤
│                                                  │
│ 이름 (2-50자):                                  │
│ [김철수_______________________________]           │
│                                                  │
│ 이메일:                                         │
│ [student@edu.com_________________________]      │
│                                                  │
│ 역할:                                           │
│ ⦿ 학생  ○ 교수자  ○ 관리자                     │
│                                                  │
│ ⚠️ 다른 관리자의 역할은 변경할 수 없습니다    │
│                                                  │
│               [취소]  [수정]                    │
└─────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자 본인은 자신의 정보를 수정할 수 없음
- 다른 관리자의 정보는 수정할 수 없음 (역할 변경 불가)
- 모든 변경은 로그에 기록

**기술적 제약**:
- 이메일 변경 시 중복 검사 필수
- 이름은 2-50자 범위만 허용

#### 관련 기능/API
- `PATCH /api/admin/users/{user_id}`: 사용자 정보 수정
- AD-USER-01: 전체 사용자 조회
- AD-USER-03: 사용자 상태 변경

---

### AD-USER-05 사용자 삭제

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 시스템에서 특정 사용자 계정을 완전히 삭제합니다.
- 보안을 위해 관리자 비밀번호 인증이 필요합니다.
- 모든 삭제는 감시 로그에 기록됩니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 더 이상 필요 없는 사용자 계정을 삭제하고
SO THAT 시스템 데이터베이스를 정리할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| user_id* | integer | ✅ | 삭제할 사용자 ID | - |
| admin_password* | string | ✅ | 관리자 비밀번호 | 본인 확인용 |
| confirm_username | string | ✅ | 사용자명 재입력 | 정확히 일치해야 함 |

#### 처리 로직
1. 사용자 목록에서 삭제 버튼 클릭
2. 삭제 경고 모달 표시
3. 관리자 비밀번호 + 사용자명 재입력 요청
4. `DELETE /api/admin/users/{user_id}` 호출
5. 서버에서 사용자 삭제:
   ```sql
   DELETE FROM users WHERE id = ?
   ```
6. 로그 기록:
   ```sql
   INSERT INTO admin_logs (admin_id, action, target_user_id, details, created_at)
   VALUES (?, 'delete_user', ?, ?, NOW())
   ```

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| deletedUserId | integer | 삭제된 사용자 ID |
| logCreated | boolean | 로그 기록 여부 |

#### UI 요소

**사용자 삭제 확인 모달**:
```
┌──────────────────────────────────────────────────┐
│ 사용자 계정 삭제                             [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ ⚠️ 경고: 이 작업은 되돌릴 수 없습니다           │
│                                                   │
│ 삭제할 사용자: 김철수 (student@edu.com)          │
│                                                   │
│ 이 작업을 수행하려면 다음을 입력하세요:         │
│                                                   │
│ 관리자 비밀번호:                                 │
│ [••••••••••••••••]                               │
│                                                   │
│ 사용자명 (정확히 입력):                          │
│ [___________________________]                    │
│                                                   │
│ ⚠️ 삭제된 모든 데이터는 복구되지 않습니다       │
│                                                   │
│          [취소]  [영구 삭제]                    │
└──────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자 본인은 자신을 삭제할 수 없음
- 다른 관리자는 삭제할 수 없음
- 관리자 비밀번호 인증 필수
- 사용자명 재입력으로 재확인 필수
- 모든 삭제는 로그에 기록

**기술적 제약**:
- 삭제는 물리적 삭제 (영구 삭제, Soft Delete 아님)
- 삭제된 사용자의 모든 관련 데이터는 외래키 제약에 따라 처리
- 삭제 작업 이전에 데이터 백업 권장

**비즈니스 제약**:
- 수업에 참여 중인 학생은 삭제 전 수업 탈퇴 필요
- 활성 수업을 소유한 교수자는 삭제 전 수업 삭제 필요

#### 관련 기능/API
- `DELETE /api/admin/users/{user_id}`: 사용자 삭제
- AD-USER-01: 전체 사용자 조회
- AD-USER-03: 사용자 상태 변경

---

### AD-LOG-01 관리 로그 조회

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 모든 관리자의 활동 이력을 조회합니다.
- 페이지네이션, 날짜/작업 유형/대상 유형별 필터링을 지원합니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 모든 관리자의 활동 이력을 조회하고
SO THAT 시스템 관리 작업의 투명성을 확보하고 보안을 모니터링할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| page | integer | ❌ | 페이지 번호 | 기본: 1 |
| limit | integer | ❌ | 페이지당 개수 | 기본: 10, 최대: 100 |
| action_type | enum | ❌ | 작업 유형 필터 | create/update/delete/status_change/login/logout/all |
| target_type | enum | ❌ | 대상 유형 필터 | user/class/setting/system/all |
| date_from | date | ❌ | 조회 시작 날짜 | YYYY-MM-DD 형식 |
| date_to | date | ❌ | 조회 종료 날짜 | YYYY-MM-DD 형식 |

#### 처리 로직
1. 관리자 대시보드 → "관리 로그" 메뉴 클릭
2. `GET /api/admin/logs` 호출 (필터 파라미터 포함)
3. 서버에서 로그 목록 조회:
   ```sql
   SELECT id, admin_id, action_type, target_type, target_id, description, ip_address, created_at
   FROM admin_logs
   WHERE
     (? = 'all' OR action_type = ?)
     AND (? = 'all' OR target_type = ?)
     AND created_at BETWEEN ? AND ?
   ORDER BY created_at DESC
   LIMIT ? OFFSET ?
   ```
4. 로그 목록 렌더링
5. 페이지네이션 표시

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| logs | array | 로그 배열 |
| logs[].id | integer | 로그 ID |
| logs[].admin_id | integer | 관리자 ID |
| logs[].action_type | enum | 작업 유형 |
| logs[].target_type | enum | 대상 유형 |
| logs[].target_id | integer | 대상 엔티티 ID |
| logs[].description | text | 작업 설명 |
| logs[].ip_address | string | IP 주소 |
| logs[].created_at | timestamp | 생성 일시 |
| total | integer | 전체 로그 수 |
| page | integer | 현재 페이지 |

#### UI 요소

**관리 로그 페이지**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 관리 로그                                                         │
├──────────────────────────────────────────────────────────────────┤
│ 작업 유형: [전체 ▼]  대상: [전체 ▼]  기간: [2025-10-01] ~ [2025-10-19] │
│ [필터 적용]  [초기화]                                             │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│ 시간         │ 관리자 │ 작업  │ 대상  │ 대상명        │ 상세       │
│ ─────────────┼──────┼──────┼──────┼──────────────┼─────────── │
│ 2025-10-19  │ admin│ 삭제  │ user │ student@e.c │ 상세보기   │
│ 10:30       │ 관리자│ 상태  │ user │ prof@e.c   │ 상세보기   │
│ 2025-10-19  │      │ 변경  │      │              │             │
│ 10:15       │      │      │      │              │             │
│                                                                   │
│ [◀ 이전] 페이지 1/3 [다음 ▶]                                     │
└──────────────────────────────────────────────────────────────────┘
```

#### 제약사항

**기술적 제약**:
- 로그 조회 API 응답 시간: < 1초
- 페이지네이션: 기본 10개씩, 최대 100개씩

**보안 제약**:
- 관리자만 접근 가능
- IP 주소는 마스킹 처리 (예: 192.168.x.x)

#### 관련 기능/API
- `GET /api/admin/logs`: 관리 로그 조회
- AD-LOG-02: 로그 상세 조회

---

### AD-LOG-02 로그 상세 조회

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 특정 관리 로그 항목의 상세 정보를 조회합니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 특정 관리 작업의 상세 정보를 확인하고
SO THAT 해당 작업의 전체 맥락을 파악할 수 있다
```

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| log_id* | integer | ✅ | 로그 ID | - |

#### 처리 로직
1. 로그 목록에서 특정 로그 행 클릭
2. `GET /api/admin/logs/{log_id}` 호출
3. 서버에서 로그 상세 정보 조회
4. 상세 정보 모달/페이지 표시

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| id | integer | 로그 ID |
| admin_id | integer | 관리자 ID |
| admin_name | string | 관리자 이름 |
| action_type | enum | 작업 유형 |
| target_type | enum | 대상 유형 |
| target_id | integer | 대상 엔티티 ID |
| description | text | 작업 설명 |
| ip_address | string | IP 주소 |
| user_agent | text | User Agent |
| created_at | timestamp | 생성 일시 |

#### UI 요소

**로그 상세 모달**:
```
┌──────────────────────────────────────────────────┐
│ 관리 로그 상세                              [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ 로그 ID: 12345                                   │
│ 관리자: 시스템 관리자                            │
│ 작업 유형: 사용자 삭제                            │
│ 대상: student@example.com (ID: 1024)            │
│ IP 주소: 192.168.x.x                            │
│ User Agent: Mozilla/5.0...                      │
│ 작업 설명:                                       │
│ 사용자 계정 student@example.com 영구 삭제        │
│ 생성 일시: 2025-10-19 10:30:45                  │
│                                                   │
│                        [닫기]                    │
└──────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자만 접근 가능
- IP 주소는 마스킹 처리

#### 관련 기능/API
- `GET /api/admin/logs/{log_id}`: 로그 상세 조회
- AD-LOG-01: 관리 로그 조회

---

### AD-CUR-01 커리큘럼 목록 조회

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 모든 커리큘럼 목록을 조회하고 관리합니다.
- 언어, 상태, 주차별로 필터링할 수 있습니다.
- 각 커리큘럼과 연결된 수업 개수를 확인할 수 있습니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 모든 커리큘럼 목록을 확인하고
SO THAT 커리큘럼을 효과적으로 관리하고 모니터링할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| search | string | ❌ | 검색어 (커리큘럼명, 설명) | - |
| language | enum | ❌ | 언어 필터 | all/C/Java/JavaScript/C# |
| status | enum | ❌ | 상태 필터 | all/active/archived |

#### 처리 로직
1. 관리자 대시보드 → "커리큘럼 관리" 메뉴 클릭
2. `GET /api/admin/curriculums` 호출
3. 서버에서 커리큘럼 목록 조회:
   ```sql
   SELECT c.id, c.name, c.description, c.language, c.weeks, c.status, c.created_at,
          COUNT(cl.id) as class_count
   FROM curricula c
   LEFT JOIN classes cl ON c.id = cl.curriculum_id
   WHERE
     (? = '' OR c.name LIKE ? OR c.description LIKE ?)
     AND (? = 'all' OR c.language = ?)
     AND (? = 'all' OR c.status = ?)
   GROUP BY c.id
   ORDER BY c.created_at DESC
   ```
4. 커리큘럼 목록 렌더링
5. 통계 카드 표시 (전체/활성/보관/수업수)

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| curriculums | array | 커리큘럼 배열 |
| curriculums[].id | integer | 커리큘럼 ID |
| curriculums[].name | string | 커리큘럼명 |
| curriculums[].description | string | 설명 |
| curriculums[].language | enum | 프로그래밍 언어 |
| curriculums[].weeks | integer | 주차 수 |
| curriculums[].status | enum | 상태 (active/archived) |
| curriculums[].class_count | integer | 연결된 수업 수 |
| curriculums[].created_at | timestamp | 생성일 |
| total | integer | 전체 커리큘럼 수 |

#### UI 요소

**커리큘럼 관리 페이지**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 커리큘럼 관리                                                     │
│ [전체: 12개] [활성: 10개] [보관: 2개] [수업: 45개]               │
├──────────────────────────────────────────────────────────────────┤
│ 언어: [전체 ▼]  상태: [전체 ▼]  [검색: ___________] [🔍]       │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│ ☐ │ ID │ 커리큘럼명           │ 언어  │ 주차 │ 상태  │ 수업  │   │
│ ──┼────┼────────────────────┼──────┼─────┼──────┼──────┼── │
│ ☐ │ 1  │ C 프로그래밍 기초    │ C     │ 12  │ 활성  │ 5    │   │
│ ☐ │ 2  │ Java OOP            │ Java  │ 12  │ 활성  │ 3    │   │
│ ☐ │ 3  │ Python 2023         │ Python│ 10  │ 보관  │ 0    │   │
│                                                                   │
│ 선택: 0개  [일괄 상태 변경 ▼]                                    │
└──────────────────────────────────────────────────────────────────┘
```

#### 제약사항

**기술적 제약**:
- 커리큘럼 목록 조회 API 응답 시간: < 1초
- 검색 시 Debounce 1초 적용

**보안 제약**:
- 관리자만 접근 가능

#### 관련 기능/API
- `GET /api/admin/curriculums`: 커리큘럼 목록 조회
- AD-CUR-02: 커리큘럼 생성
- AD-CUR-03: 커리큘럼 수정
- AD-CUR-04: 커리큘럼 상태 변경
- AD-CUR-05: 커리큘럼 삭제

---

### AD-CUR-02 커리큘럼 생성

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 새로운 커리큘럼을 생성합니다.
- 관리자만 커리큘럼을 등록할 수 있습니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 새로운 커리큘럼을 생성하고
SO THAT 교수자가 해당 커리큘럼으로 수업을 만들 수 있도록 한다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| name* | string | ✅ | 커리큘럼명 | 2-100자 |
| description* | string | ✅ | 설명 | 10-1000자 |
| language* | enum | ✅ | 프로그래밍 언어 | C/Java/JavaScript/C# |
| weeks* | integer | ✅ | 주차 수 | 1-52 |
| status | enum | ❌ | 상태 | active/archived (기본: active) |

#### 처리 로직
1. "새 커리큘럼" 버튼 클릭
2. 생성 모달 표시
3. `POST /api/admin/curriculums` 호출
4. 서버에서 커리큘럼 생성:
   ```sql
   INSERT INTO curricula (name, description, language, weeks, status, created_at)
   VALUES (?, ?, ?, ?, 'active', NOW())
   ```
5. 로그 기록:
   ```sql
   INSERT INTO admin_logs (admin_id, action, target_type, target_id, details, created_at)
   VALUES (?, 'create_curriculum', 'curriculum', ?, ?, NOW())
   ```

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| curriculum | object | 생성된 커리큘럼 정보 |
| message | string | 성공 메시지 |

#### UI 요소

**커리큘럼 생성 모달**:
```
┌──────────────────────────────────────────────────┐
│ 새 커리큘럼 등록                            [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ 커리큘럼명 (2-100자)*:                           │
│ [_______________________________________]        │
│                                                   │
│ 프로그래밍 언어*:                                │
│ ⦿ C  ○ Java  ○ JavaScript  ○ C#                 │
│                                                   │
│ 주차 수 (1-52)*:                                │
│ [12__]                                           │
│                                                   │
│ 설명 (10-1000자)*:                              │
│ [_______________________________________]        │
│ [_______________________________________]        │
│ [_______________________________________]        │
│                                                   │
│ 상태:                                            │
│ ⦿ 활성  ○ 보관                                  │
│                                                   │
│               [취소]  [등록]                    │
└──────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자만 커리큘럼 생성 가능
- 모든 생성은 로그에 기록

**비즈니스 제약**:
- 같은 언어와 이름의 커리큘럼은 중복 생성 불가

#### 관련 기능/API
- `POST /api/admin/curriculums`: 커리큘럼 생성
- AD-CUR-01: 커리큘럼 목록 조회

---

### AD-CUR-03 커리큘럼 수정

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 기존 커리큘럼의 정보를 수정합니다.

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| curriculum_id* | integer | ✅ | 커리큘럼 ID | - |
| name* | string | ✅ | 커리큘럼명 | 2-100자 |
| description* | string | ✅ | 설명 | 10-1000자 |
| weeks* | integer | ✅ | 주차 수 | 1-52 |

#### 처리 로직
1. 커리큘럼 목록에서 수정 버튼 클릭
2. 수정 모달 표시 (현재 정보 프리필)
3. `PATCH /api/admin/curriculums/{curriculum_id}` 호출
4. 서버에서 커리큘럼 업데이트:
   ```sql
   UPDATE curricula
   SET name = ?, description = ?, weeks = ?
   WHERE id = ?
   ```
5. 로그 기록

#### 제약사항

**비즈니스 제약**:
- 프로그래밍 언어는 수정 불가 (새로 생성 필요)
- 수업과 연결된 커리큘럼의 주차 수는 수정 시 주의 필요

#### 관련 기능/API
- `PATCH /api/admin/curriculums/{curriculum_id}`: 커리큘럼 수정
- AD-CUR-01: 커리큘럼 목록 조회

---

### AD-CUR-04 커리큘럼 상태 변경

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 커리큘럼의 상태를 활성(active) 또는 보관(archived)으로 변경합니다.
- 보관된 커리큘럼은 수업 생성 시 선택할 수 없습니다.
- 일괄 상태 변경을 지원합니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 더 이상 사용하지 않는 커리큘럼을 보관 상태로 변경하고
SO THAT 수업 생성 시 선택지를 정리하고 혼란을 방지할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| curriculum_ids* | array | ✅ | 커리큘럼 ID 배열 | 1개 이상 |
| status* | enum | ✅ | 변경할 상태 | active/archived |

#### 처리 로직
1. 커리큘럼 선택 (체크박스)
2. "일괄 상태 변경" 버튼 클릭
3. 상태 선택 모달 표시
4. `PATCH /api/admin/curriculums/{curriculum_id}` 호출 (각 커리큘럼)
5. 서버에서 상태 업데이트:
   ```sql
   UPDATE curricula
   SET status = ?
   WHERE id IN (?)
   ```

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| updated_count | integer | 변경된 커리큘럼 수 |
| message | string | 성공 메시지 |

#### UI 요소

**일괄 상태 변경 모달**:
```
┌──────────────────────────────────────────────────┐
│ 일괄 상태 변경                              [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ 선택된 커리큘럼: 3개                             │
│                                                   │
│ 변경할 상태:                                     │
│                                                   │
│ ⦿ 활성 (Active)                                 │
│   └ 수업 생성 시 선택 가능                       │
│                                                   │
│ ○ 보관 (Archived)                               │
│   └ 더 이상 사용하지 않는 커리큘럼               │
│   └ 수업 생성 시 선택 불가                       │
│                                                   │
│               [취소]  [변경]                    │
└──────────────────────────────────────────────────┘
```

#### 제약사항

**비즈니스 제약**:
- 활성 ↔ 보관 양방향 전환 가능
- 보관 상태의 커리큘럼은 새 수업 생성 시 선택 불가
- 기존에 연결된 수업에는 영향 없음

#### 관련 기능/API
- `PATCH /api/admin/curriculums/{curriculum_id}`: 커리큘럼 상태 변경
- AD-CUR-01: 커리큘럼 목록 조회

---

### AD-CUR-05 커리큘럼 삭제

**우선순위**: P0
**담당 역할**: Admin

#### 기능 개요
- 시스템에서 커리큘럼을 완전히 삭제합니다.
- 연결된 수업이 있는 커리큘럼은 삭제할 수 없습니다.
- 보안을 위해 관리자 비밀번호와 커리큘럼명 재확인이 필요합니다.

#### 사용자 스토리
```
AS A 관리자
I WANT TO 더 이상 필요 없는 커리큘럼을 삭제하고
SO THAT 시스템 데이터를 정리할 수 있다
```

#### 전제조건
- 관리자로 로그인된 상태

#### 입력
| 필드명 | 타입 | 필수 | 설명 | 제약사항 |
|--------|------|------|------|----------|
| curriculum_id* | integer | ✅ | 삭제할 커리큘럼 ID | - |
| admin_password* | string | ✅ | 관리자 비밀번호 | 본인 확인용 |
| confirm_name* | string | ✅ | 커리큘럼명 재입력 | 정확히 일치해야 함 |

#### 처리 로직
1. 커리큘럼 목록에서 삭제 버튼 클릭
2. 연결된 수업 개수 확인
3. 수업이 있으면 삭제 불가 메시지 표시:
   - "이 커리큘럼과 연결된 X개의 수업이 있어 삭제할 수 없습니다."
   - "먼저 상태를 '보관'으로 변경하세요."
4. 수업이 없으면 삭제 확인 모달 표시
5. 관리자 비밀번호 + 커리큘럼명 재입력 요청
6. `DELETE /api/admin/curriculums/{curriculum_id}` 호출
7. 서버에서 커리큘럼 삭제:
   ```sql
   -- 연결된 수업 확인
   SELECT COUNT(*) FROM classes WHERE curriculum_id = ?

   -- 없으면 삭제
   DELETE FROM curricula WHERE id = ?
   ```
8. 로그 기록

#### 출력
| 필드명 | 타입 | 설명 |
|--------|------|------|
| deleted_id | integer | 삭제된 커리큘럼 ID |
| message | string | 성공 메시지 |

#### UI 요소

**커리큘럼 삭제 확인 모달 (수업 연결 시)**:
```
┌──────────────────────────────────────────────────┐
│ 커리큘럼 삭제 불가                          [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ ⚠️ 이 커리큘럼과 연결된 5개의 수업이 있습니다  │
│                                                   │
│ 커리큘럼: C 프로그래밍 기초                      │
│ 연결된 수업: 5개                                 │
│                                                   │
│ 이 커리큘럼은 삭제할 수 없습니다.               │
│                                                   │
│ 💡 대신 다음 조치를 권장합니다:                 │
│ 1. 상태를 '보관'으로 변경                       │
│ 2. 새 수업 생성 시 선택 불가 처리               │
│                                                   │
│          [닫기]  [보관으로 변경]                │
└──────────────────────────────────────────────────┘
```

**커리큘럼 삭제 확인 모달 (수업 없음)**:
```
┌──────────────────────────────────────────────────┐
│ 커리큘럼 삭제                               [X]  │
├──────────────────────────────────────────────────┤
│                                                   │
│ ⚠️ 경고: 이 작업은 되돌릴 수 없습니다           │
│                                                   │
│ 삭제할 커리큘럼: C 프로그래밍 기초               │
│ 연결된 수업: 0개                                 │
│                                                   │
│ 이 작업을 수행하려면 다음을 입력하세요:         │
│                                                   │
│ 관리자 비밀번호:                                 │
│ [••••••••••••••••]                               │
│                                                   │
│ 커리큘럼명 (정확히 입력):                        │
│ [_______________________________________]        │
│                                                   │
│ ⚠️ 삭제된 모든 데이터는 복구되지 않습니다       │
│                                                   │
│          [취소]  [영구 삭제]                    │
└──────────────────────────────────────────────────┘
```

#### 제약사항

**보안 제약**:
- 관리자 비밀번호 인증 필수
- 커리큘럼명 재입력으로 재확인 필수
- 모든 삭제는 로그에 기록

**비즈니스 제약**:
- **연결된 수업이 있는 커리큘럼은 삭제 불가**
- 삭제 대신 '보관' 상태로 전환 권장

**기술적 제약**:
- 삭제는 물리적 삭제 (영구 삭제)
- 삭제 작업 이전에 데이터 백업 권장

#### 커리큘럼 정책 요약

1. **생성 권한**: 관리자만 커리큘럼 등록 가능
2. **삭제 제약**: 연결된 수업이 있는 커리큘럼은 삭제 불가
3. **삭제 보안**: 관리자 비밀번호 + 커리큘럼명 재확인 필수
4. **상태 관리**:
   - **활성(active)**: 수업 생성 시 선택 가능
   - **보관(archived)**: 더 이상 사용하지 않는 커리큘럼, 수업 생성 불가
5. **상태 전환**: 활성 ↔ 보관 양방향 전환 가능

#### 관련 기능/API
- `DELETE /api/admin/curriculums/{curriculum_id}`: 커리큘럼 삭제
- AD-CUR-01: 커리큘럼 목록 조회
- AD-CUR-04: 커리큘럼 상태 변경

---
